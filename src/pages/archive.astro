---
import { Image, getImage } from "astro:assets";
// Import images directly
import tourPoster from "../assets/archive/1.png";
import aerv from "../assets/archive/2.png";
import aec3 from "../assets/archive/3.png";
import orbisLibri from "../assets/archive/4.png";
import rebornPoster from "../assets/archive/5.png";
import CycleImage from "../components/CycleImage";
import Layout from "../layouts/Layout.astro";

// Optimize images for different sizes with responsive variants
const optimizeImage = async (src: ImageMetadata) => {
	const [small, medium, large] = await Promise.all([
		getImage({ src, width: 400, format: "webp", quality: 85 }),
		getImage({ src, width: 800, format: "webp", quality: 85 }),
		getImage({ src, width: 1200, format: "webp", quality: 85 }),
	]);
	return { small, medium, large };
};

const [
	tourPosterOptimized,
	aervOptimized,
	aec3Optimized,
	orbisLibriOptimized,
	rebornPosterOptimized,
] = await Promise.all([
	optimizeImage(tourPoster),
	optimizeImage(aerv),
	optimizeImage(aec3),
	optimizeImage(orbisLibri),
	optimizeImage(rebornPoster),
]);

// Client-usable list of optimized images with responsive sources
const clientImages = [
	{
		title: "tour_poster_photoshot_2024.png",
		src: tourPosterOptimized.medium.src,
		srcSet: `${tourPosterOptimized.small.src} 400w, ${tourPosterOptimized.medium.src} 800w, ${tourPosterOptimized.large.src} 1200w`,
		sizes: "(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px",
		width: tourPosterOptimized.medium.attributes.width,
		height: tourPosterOptimized.medium.attributes.height,
	},
	{
		title: "aerv.png",
		src: aervOptimized.medium.src,
		srcSet: `${aervOptimized.small.src} 400w, ${aervOptimized.medium.src} 800w, ${aervOptimized.large.src} 1200w`,
		sizes: "(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px",
		width: aervOptimized.medium.attributes.width,
		height: aervOptimized.medium.attributes.height,
	},
	{
		title: "aec3.png",
		src: aec3Optimized.medium.src,
		srcSet: `${aec3Optimized.small.src} 400w, ${aec3Optimized.medium.src} 800w, ${aec3Optimized.large.src} 1200w`,
		sizes: "(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px",
		width: aec3Optimized.medium.attributes.width,
		height: aec3Optimized.medium.attributes.height,
	},
	{
		title: "orbis_libri_logo_blue.png",
		src: orbisLibriOptimized.medium.src,
		srcSet: `${orbisLibriOptimized.small.src} 400w, ${orbisLibriOptimized.medium.src} 800w, ${orbisLibriOptimized.large.src} 1200w`,
		sizes: "(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px",
		width: orbisLibriOptimized.medium.attributes.width,
		height: orbisLibriOptimized.medium.attributes.height,
	},
	{
		title: "reborn_poster.png",
		src: rebornPosterOptimized.medium.src,
		srcSet: `${rebornPosterOptimized.small.src} 400w, ${rebornPosterOptimized.medium.src} 800w, ${rebornPosterOptimized.large.src} 1200w`,
		sizes: "(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px",
		width: rebornPosterOptimized.medium.attributes.width,
		height: rebornPosterOptimized.medium.attributes.height,
	},
];
---

<Layout title="Archive |">
  <section class="w-full max-w-7xl mx-auto bg-background text-palette-brightest-white py-36">
    <div class="container mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 px-4">
        {clientImages.map((item, index) => (
          <div class="relative group max-w-2xl mx-auto w-full">
            <CycleImage 
              client:load 
              images={clientImages} 
              startIndex={index}
              className="w-full h-auto select-none object-contain"
            />
          </div>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
	/* Prevent layout shift and improve image cycling */
	.cycle-image-container {
		contain: layout style paint;
		will-change: contents;
	}
	
	/* Smooth image transitions */
	img {
		transition: opacity 0.2s ease-in-out;
		will-change: contents;
	}
	
	/* Prevent scroll jumping and touch behaviors */
	img[tabindex] {
		user-select: none;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		-webkit-touch-callout: none;
		-webkit-tap-highlight-color: transparent;
		touch-action: manipulation;
	}
	
	/* Prevent any layout shifting during image cycling */
	.cycle-image-container img {
		transform: translateZ(0); /* Force hardware acceleration */
		-webkit-backface-visibility: hidden;
		backface-visibility: hidden;
	}
	
	/* Ensure grid doesn't reflow */
	.grid {
		isolation: isolate;
	}
</style> 